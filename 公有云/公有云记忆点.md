格式化硬盘

```
mkfs
```

安装NFS

```
yum install -y nfs-utils rpcbind

/nfs/code *(rw)

权限不够，后面打开权限就可以
```

wordpress

```
yum isntall -y mariadb-server php php-fpm php-mysql php-gd
记不住写php*号

rpm -ivh gpmall-repo/packages/nginx
修改nginx配置文件  外网ip添加默认访问index.php和php方式访问  修改成工作目录

修改php配置文件/etc/php-fpm.d/www.conf    修改apache用户和组

启动各服务 “数据库 nginx php-fpm”

导入数据 授权

替换前端文件，修改config文件名并修改内容


报错查看/var/log/nginx/error.log
```

放通NFS端口

```
UDP:123
```

部署MongoDB数据库服务

```
[root@mysql-1 ~]# yum install -y mongodb-org 
[root@mysql-2 ~]# yum install -y mongodb-org 
[root@mysql-1 ~]# systemctl restart mongod
[root@mysql-2 ~]# systemctl restart mongod
```

MongoDB 主从数据库，配置MongoDB 集群名称为 rs 

```
修改MongoDB配置文件 （两个都要改）

[root@mysql-1 ~]# vi /etc/mongod.conf
net:
  port:27017
  bindIp:0.0.0.0   #修改

replication
  replSetName: rs   #添加
  
重启服务

数据库配置( 在mysql-1配置就可以了 )
> use admin 
switched to db admin
> cfg={ _id:"rs", members:[ {_id:0,host:'172.16.1.88:27017',priority:2}, {_id:1,host:'172.16.1.89:27017',priority:1}] };
{
        "_id" : "rs",
        "members" : [
                {
                        "_id" : 0,
                        "host" : "172.16.1.88:27017",
                        "priority" : 2
                },
                {
                        "_id" : 1,
                        "host" : "172.16.1.89:27017",
                        "priority" : 1
                }
        ]
}
> rs.initiate(cfg)
{ "ok" : 1 }   要显示ok 1
rs:SECONDARY> rs.status()
```

node 环境管理

```
使用提供的压缩文件 rocketchat-cloud.tar.gz 中软件包源，在 ChinaSkill-node-1 部署 nodejs，
根据 所提供 的 rocket.chat 所 需要求 安 装 nodejs 对 应版本。
tar xf node-v12.16.1-linux-x64.tar.gz 
mv node-v12.16.1-linux-x64 /usr/local/node
ln -s /usr/local/node/bin/* /usr/bin/
node -v
```

RocketChat 上云

```
使用 http 服务器提供的压缩文件 rocketchat-cloud.tar.gz 中的 RocketChat 软件包，在ChinaSkill-node-1 中部署 RocketChat 的 Web 服务。使用 chinaskill-sql-1 的 MongoDB 为后端数据库，设置 RocketChat 服务访问端口为 3000。

```

数据库主从同步

```
(3)、修改主库配置文件

 log-bin:设置logbin文件名称，最好不要改动位置。

 server-id:该id主从之间必须是唯一，唯一的标识。

 binlog-ignore-db:指定不可以主从同步的数据库，多数据库则配置多行


/etc/my.cnf.d/server.cnf
[msyqld]
server-id=1
binlog-ignore=mysql
log-bin=mysql-bin

登录主数据库设置主从同步用户

登录从数据库配置从配置
change master to master_host='',master_user='',master_password='';

start slave;

查看 show status slave \G;
```

读写分离

```
中间节点
安装java环境
yum install MariaDB-client -y

修改配置文件


指向中间节点
修改配置文件改成中间节点
```

数据库迁移至公有云实例

```
修改配置文件改成公有云数据库实例

远程登录数据库导入库
```

备份数据库/result

```
msyqldump -uroot -pAbc@1234 wordpress > /result/mysql_bak.sql
```

扩容云硬盘

```
还需要进入Linux系统，进行文件系统的扩容
resize2fs /dev/vdb
df -TH
```

网上商城

```
域名解析

修改nginx配置文件   注:修改成公网地址

执行jar包  ps -ef 
```

