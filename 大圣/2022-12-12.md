1、【实操题】基础环境配置（2分）

使用提供的用户名密码，登录提供的OpenStack私有云平台，在当前租户下，使用CentOS7.9镜像，创建两台云主机，云主机类型使用4vCPU/12G/100G_50G类型。当前租户下默认存在一张网卡，自行创建第二张网卡并连接至controller和compute节点（第二张网卡的网段为10.10.X.0/24，X为工位号，不需要创建路由）。自行检查安全组策略，以确保网络正常通信与ssh连接，然后按以下要求配置服务器：

（1）设置控制节点主机名为controller，设置计算节点主机名为compute；

（2）修改hosts文件将IP地址映射为主机名；

完成后提交控制节点的用户名、密码和IP地址到答题框。

```

```



2、【实操题】Yum源配置（2分）

使用提供的http服务地址，在http服务下，存在centos7.9和iaas的网络yum源，使用该http源作为安装iaas平台的网络源。分别设置controller节点和compute节点的yum源文件http.repo。完成后提交控制节点的用户名、密码和IP地址到答题框。（0？？？）

```

```



3、【实操题】配置无秘钥ssh（2分）

配置controller节点可以无秘钥访问compute节点，配置完成后，尝试ssh连接compute节点的hostname进行测试。完成后提交controller节点的用户名、密码和IP地址到答题框。

```

```

4、【实操题】基础安装（2分）

在控制节点和计算节点上分别安装openstack-iaas软件包，根据表2配置两个节点脚本文件中的基本变量（配置脚本文件为/etc/openstack/openrc.sh）。

> （记得修改密码为节点的密码，不要写000000）

表2 云平台配置信息

| 服务名称         | 变量               | 参数/密码 |
| ---------------- | ------------------ | --------- |
| Mysql            | root               | 000000    |
| Keystone         | 000000             |           |
| Glance           | 000000             |           |
| Nova             | 000000             |           |
| Neutron          | 000000             |           |
| Heat             | 000000             |           |
| Zun              | 000000             |           |
| Keystone         | DOMAIN_NAME        | demo      |
| Admin            | 000000             |           |
| Rabbit           | 000000             |           |
| Glance           | 000000             |           |
| Nova             | 000000             |           |
| Neutron          | 000000             |           |
| Heat             | 000000             |           |
| Zun              | 000000             |           |
| Neutron          | Metadata           | 000000    |
| External Network | eth1（以实际为准） |           |

完成后提交控制节点的用户名、密码和IP地址到答题框。





5、【实操题】数据库安装与调优（2分）

在controller节点上使用iaas-install-mysql.sh 脚本安装Mariadb、Memcached、RabbitMQ等服务。安装服务完毕后，修改/etc/my.cnf文件，完成下列要求：

1.设置数据库支持大小写；

2.设置数据库缓存innodb表的索引，数据，插入数据时的缓冲为4G；

完成后提交控制节点的用户名、密码和IP地址到答题框。

```
lower_case_table_names = 1
innodb_buffer_pool_size = 4G
```

6、【实操题】Keystone服务安装与使用（2分）

在controller节点上使用iaas-install-keystone.sh脚本安装Keystone服务。安装完成后，使用相关命令，创建用户chinaskill，密码为000000。完成后提交控制节点的用户名、密码和IP地址到答题框。

```
openstack user create chinaskill --password 000000
```



7、【实操题】Glance安装与使用（2分）

在controller节点上使用iaas-install-glance.sh脚本安装glance 服务。使用命令将提供的cirros-0.3.4-x86_64-disk.img镜像（该镜像在HTTP服务中，可自行下载）上传至平台，命名为cirros，并设置最小启动需要的硬盘为10G。完成后提交控制节点的用户名、密码和IP地址到答题框。(1 ?  ?  ?)

```

```



8、【实操题】Nova安装与优化（2分）

在controller节点和compute节点上分别使用iaas-install-placement.sh脚本、iaas-install-nova -controller.sh脚本、iaas-install-nova-compute.sh脚本安装Nova服务。安装完成后，请修改nova相关配置文件，解决因等待时间过长而导致虚拟机启动超时从而获取不到IP地址而报错失败的问题。配置完成后提交controller点的用户名、密码和IP地址到答题框。

```
vif_plugging_is_fatal=false
systemctl restart *nova*
```



9、【实操题】Neutron安装（2分）

使用提供的脚本iaas-install-neutron-controller.sh和iaas-install-neutron-compute.sh，在controller和compute节点上安装neutron服务。完成后提交控制节点的用户名、密码和IP地址到答题框。

```

```



10、【实操题】Doshboard安装（2分）

在controller节点上使用iaas-install-dashboad.sh脚本安装dashboad服务。完成后提交控制节点的用户名、密码和IP地址到答题框。

```

```





11、【实操题】Swift安装（2分）

在控制节点和计算节点上分别使用iaas-install-swift-controller.sh和iaas-install-swift-compute.sh脚本安装Swift服务。完成后提交控制节点的用户名、密码和IP地址到答题框。

```

```





12、【实操题】Cinder创建硬盘（2分）

在控制节点和计算节点分别使用iaas-install-cinder-controller.sh、iaas-install-cinder-compute.sh脚本安装Cinder服务，请在计算节点，对块存储进行扩容操作，即在计算节点再分出一个5G的分区，加入到cinder块存储的后端存储中去。完成后提交计算节点的用户名、密码和IP地址到答题框。(0 ? ? ?)

```
pvcreate /dev/sdc
vgextend cinder-volumes /dev/sdc

vgdisplay
```



13、【实操题】Barbican服务安装与使用（2分）

使用iaas-install-barbican.sh脚本安装barbican服务，安装服务完毕后，使用openstack命令创建一个名为secret01的密钥，创建完成后提交控制节点的用户名、密码和IP地址到答题框。

```
openstack secret store --name secret01
```

14、【实操题】manila安装（2分）

在控制和计算节点上分别使用iaas-install-manila-controller.sh和iaas-install-manila-compute.sh脚本安装manila服务。安装服务后创建default_share_type共享类型（不使用驱动程序支持），接着创建一个大小为2G的共享存储名为share01。最后提交控制节点的用户名、密码和IP地址到答题框。

```
manila type-create default_share_type 0
manila create NFS 2 --name share01
```

15、【实操题】Cloudkitty服务安装与使用（2分）

使用iaas-install-cloudkitty.sh脚本安装cloudkitty服务，安装完毕后，启用hashmap评级模块。设置完成后提交控制节点的用户名、密码和IP地址到答题框。

```
openstack rating module enable hashmap
```

16、【实操题】OpenStack平台内存优化（2分）

搭建完OpenStack平台后，关闭系统的内存共享，打开透明大页。完成后提交控制节点的用户名、密码和IP地址到答题框。

```
echo 'never' > /sys/kernel/mm/transparent_hugepage/defrag

ipcs
```



17、【实操题】OpenStack Glance镜像压缩（2分）

使用自行搭建的OpenStack平台。在HTTP服务中存在一个镜像为CentOS7.5-compress.qcow2的镜像，请使用qemu相关命令，对该镜像进行压缩，压缩后的镜像命名为chinaskill-js-compress.qcow2并存放在/root目录下。完成后提交controller点的用户名、密码和IP地址到答题框。

```
qemu-img convert -c -O qcow2 CentOS7.5-compress.qcow2 chinaskill-js-compress.qcow2
```

18、【实操题】修改文件句柄数（2分）

Linux服务器大并发时，往往需要预先调优Linux参数。默认情况下，Linux最大文件句柄数为1024个。当你的服务器在大并发达到极限时，就会报出“too many open files”。创建一台云主机，修改相关配置，将控制节点的最大文件句柄数永久修改为65535。配置完成后提交controller点的用户名、密码和IP地址到答题框。

```bash
vim /etc/security/limits.conf
* hard nofile 65535
* soft nofile 65535

ulimit -n 65535
```

19、【实操题】OpenStack参数调优（2分）

OpenStack各服务内部通信都是通过RPC来交互，各agent都需要去连接RabbitMQ；随着各服务agent增多，MQ的连接数会随之增多，最终可能会到达上限，成为瓶颈。使用自行搭建的OpenStack私有云平台，分别通过用户级别、系统级别、配置文件来设置RabbitMQ服务的最大连接数为10240，配置完成后提交修改节点的用户名、密码和IP地址到答题框。

```python
vim /etc/security/limits.conf
openstack hard nofile 10240
openstack soft nofile 10240

vim /usr/lib/systemd/system/rabbitmq-server.service
LimitNOFILE=10240

systemctl daemon-reload
systemctl restart rabbitmq-server

vi /etc/sysctl.conf
fs.file-max = 10240

sysctl -p
```

20、【实操题】Linux系统调优-防止SYN攻击（2分）

修改controller节点的相关配置文件，开启SYN cookie，防止SYN洪水攻击。完成后提交controller节点的用户名、密码和IP地址到答题框

```bash
vi /etc/sysctl.conf
net.ipv4.tcp_syncookies = 1
sysctl -p
```

21、【实操题】OpenStack开放镜像权限（2分）

使用OpenStack私有云平台，在OpenStack平台的admin项目中使用cirros-0.3.4-x86_64-disk.img镜像文件创建名为glance-cirros的镜像，通过OpenStack命令将glance-cirros镜像指定demo项目进行共享使用。配置完成后提交controller点的用户名、密码和IP地址到答题框。

```bash
先将镜像共享给A租户
glance member-create 镜像id A租户id【projectA】
共享之后，镜像的状态是pending状态，还需要激活镜像
glance member-update  镜像id A租户id【projectA】 accepted
```



22、【实操题】glance对接cinder后端存储（2分）

在自行搭建的OpenStack平台中修改相关参数，使glance可以使用cinder作为后端存储，将镜像存储于cinder卷中。使用cirros-0.3.4-x86_64-disk.img文件创建cirros-image镜像存储于cirros-cinder卷中，通过cirros-image镜像使用cinder卷启动盘的方式进行创建虚拟机。完成后提交修改节点的用户名、密码和IP地址到答题框。

```bash
在自行搭建的OpenStack平台中修改相关参数，使glance可以使用cinder作为后端存储，将镜像存储于cinder卷中。使用cirros-0.3.4-x86_64-disk.img文件创建cirros-image镜像存储于cirros-cinder卷中，通过cirros-image镜像使用cinder卷启动盘的方式进行创建虚拟机。

vi /etc/glance/glance-api.conf

stores = file, http, cinder
show_multiple_locations = True

/etc/cinder/cinder.conf
glance_api_version = 2     ##这个配置字段默认没有，在第300行那一片添加就行
allowed_direct_url_schemes = cinder
#以下字段在cinder配置文件里没有，直接在最后面添加就行
[lvm]
image_upload_use_internal_tenant = True

systemctl restart *glance* *cinder* 

创建镜像
openstack image create --container-format bare --disk-format raw --file /opt/openstack/images/cirros-0.3.4-x86_64-disk.img  cirros 
根据此镜像创建一个cinder卷        
cinder create --image cirros --name cirros-cinder 1
根据刚才含有镜像的卷创建出cirros-image镜像
openstack image create --container-format bare --disk-format raw --volume cirros-cinder  cirros-image 
```



23、【实操题】OpenStack Nova清除缓存（2分）

在OpenStack平台的一台计算节点创建虚拟机，若是第一次在该节点创建次虚拟机，会先将镜像文件复制到该计算节点目录/var/lib/nova/instances/_base。长期下来，该目录会占用比较大的磁盘空间而要清理。可以通过修改nova的配置文件来自动清理该缓存目录，即在该节点没有使用某镜像启动的云主机，那么这个镜像在过一定的时间后会被自动删除。配置完成后提交改动节点的用户名、密码和IP地址到答题框。

```bash
remove_unused_base_images=true
```



24、【实操题】Python运维开发：基于OpenStack Restful API实现镜像上传（2分）

使用OpenStack all-in-one镜像，创建OpenStack Python运维开发环境。云主机的用户/密码为：“root/Abc@1234”，OpenStack的域名/账号/密码为：“demo/admin/000000”。

提示说明：python脚本文件头建议加入“#encoding:utf-8”避免编码错误；测试脚本代码用python3命令执行与测试。

在controller节点的/root目录下创建api_image_manager.py脚本，编写python代码对接OpenStack API，完成镜像的创建与上传。创建之前查询是否存在“同名镜像”，如果存在先删除该镜像。

（1）创建镜像：要求在OpenStack私有云平台中上传镜像cirros-0.3.4-x86_64-disk.img，名字为cirros001，disk_format为qcow2，container_format为bare。

（2）查询镜像：查询cirros001的详细信息，并以json格式文本输出到控制台。

完成后提交OpenStack Python运维开发环境Controller节点的IP地址，用户名和密码提交。

```python
去创建所需镜像就可以

#“root/Abc@1234”，OpenStack的域名/账号/密码为：“demo/admin/000000”。
import  requests,json
controller="10.26.24.73"
url=f"http://{controller}:5000/v3/auth/tokens"
body={
    "auth":{
        "identity":{
            "methods":["password"],
            "password":{
                "user":{
                    "domain":{"name":"demo"},
                    "name":"admin",
                    "password":"000000"
                }
            }
        },
        "scope":{
            "project":{
                "domain":{"name":"demo"},
                "name":"admin"
            }
        }
    }
}
headers={
    "Content-Type":"application/json"
}
Token=requests.post(url=url,headers=headers,data=json.dumps(body)).headers["X-Subject-Token"]
headers={
    "X-Auth-Token":Token
}
print(headers)
image_url=f"http://{controller}:9292/v2/images/d68e86f2-a233-445e-9a47-b0645356d476"
re=json.loads(requests.get(image_url,headers=headers).text)
print(re)
```

![image-20221213170113630](2022-12-12.assets/image-20221213170113630.png)

![image-20221213170355429](2022-12-12.assets/image-20221213170355429.png)

25、【实操题】Python运维开发：基于Openstack Python SDK实现云主机创建（2分）

使用已建好的OpenStack Python运维开发环境，在/root目录下创建sdk_server_manager.py脚本，使用python-openstacksdk Python模块，完成云主机的创建和查询。创建之前查询是否存在“同名云主机”，如果存在先删除该镜像。

（1）创建1台云主机：云主机信息如下：

云主机名称如下：server001

镜像文件：cirros-0.3.4-x86_64-disk.img

云主机类型：m1.tiny

网络等必要信息自己补充。

（2）查询云主机：查询云主机server001的详细信息，并以json格式文本输出到控制台。

完成后提交OpenStack Python运维开发环境 Controller节点的IP地址，用户名和密码提交。

```python
自行创建所需云主机


import json
import openstack
def create_connection():
    return openstack.connect(
        auth_url="http://10.10.16.30:5000/v3/",
        user_domain_name='demo',
        username="admin",
        password="000000",
    )
print(create_connection())

class server_manager:  
    def __init__(self, connect):  
        self.connect = connect  
    def get_server(self, server_name):  
        """  
        获取云主机  
        :param server_name:  
        :return:  
        """  
        server = self.connect.compute.find_server(server_name)  
        return json.dumps(server, indent=2, skipkeys=True)
if __name__ == '__main__':  
    conn = create_connection() 
    sdk_m = server_manager(conn) 
    result = sdk_m.get_server("server001")  
    print("servers:", result)
```





1、【实操题】平台部署--部署容器云平台（2分）

登录OpenStack私有云平台，使用CentOS7.9镜像创建两台云主机，使用kubeeasy工具完成Kubernetes 1.22.1集群的搭建。

完成后提交master节点的用户名、密码和IP到答题框。



2、【实操题】平台部署--部署Istio服务网格（2分）

在Kubernetes集群上完成Istio服务网格环境的安装。

完成后提交master节点的用户名、密码和IP到答题框。



3、【实操题】平台部署--部署KubeVirt虚拟化



4、【实操题】平台部署--部署Harbor仓库及Helm包管理工具（2分）

在master节点上完成Harbor镜像仓库及Helm包管理工具的部署。

完成后提交master节点的用户名、密码和IP到答题框。





5、【实操题】容器化Memcached服务（2分）

在master节点/root/DjangoBlog目录下编写Dockerfile-memcached文件构建blog-memcached:v1.0镜像，具体要求如下：（需要用到的软件包：Django.tar.gz）

（1）基础镜像：centos:7.9.2009；

（2）完成memcached服务的安装；

（3）声明端口：11211；

（4）设置服务开机自启。

完成后构建镜像，并提交master节点的用户名、密码和IP地址到答题框。

```dockerfile
[root@master ~]# cd DjangoBlog/
[root@master DjangoBlog]# vi local.repo 
[yum]
name=yum
baseurl=file:///root/yum
gpgcheck=0
enabled=1

[root@master DjangoBlog]# vi Dockerfile-memcached
FROM centos:centos7.9.2009
MAINTAINER Chinaskills
RUN rm -rf /etc/yum.repos.d/*
COPY local.repo /etc/yum.repos.d/
COPY yum /root/yum
RUN yum install libevent libevent-devel -y
RUN yum install memcached -y
EXPOSE 11211
ENTRYPOINT /usr/bin/memcached -u root

docker build -t blog-memcached:v1.0 -f Dockerfile-memcached .
```

6、【实操题】容器化Mariadb服务（2分）

在master节点/root/DjangoBlog目录下编写Dockerfile-mariadb文件构建blog-mysql:v1.0镜像，具体要求如下：（需要用到的软件包：Django.tar.gz）

（1）基础镜像：centos:7.9.2009；

（2）安装MariaDB服务并设置root用户的密码为root；

（3）创建数据库djangoblog并将sqlfile.sql导入该数据库；

（4）声明端口：3306；

（5）设置服务开机自启。

完成后构建镜像，并提交master节点的用户名、密码和IP地址到答题框。

```bash
[root@master DjangoBlog]# vi mysql_init.sh 
#!/bin/bash
mysql_install_db --user=root
mysqld_safe --user=root &
sleep 8
mysqladmin -u root password 'root'
mysql -uroot -proot -e "grant all on *.* to 'root'@'%' identified by 'root';flush privileges;"
mysql -uroot -proot -e "create database djangoblog;use djangoblog;source /opt/sqlfile.sql;"

[root@master DjangoBlog]# vi Dockerfile-mariadb 
FROM centos:centos7.9.2009
MAINTAINER Chinaskills
RUN rm -rf /etc/yum.repos.d/*
COPY local.repo /etc/yum.repos.d/
COPY yum /root/yum
ENV LC_ALL en_US.UTF-8
RUN yum -y install mariadb-server
COPY mysql_init.sh /opt/
COPY sqlfile.sql /opt
RUN bash /opt/mysql_init.sh
EXPOSE 3306
CMD ["mysqld_safe","--user=root"]


docker build -t blog-mysql:v1.0 -f Dockerfile-mariadb .
```

7、【实操题】容器化前端服务

```dockerfile
[root@master DjangoBlog]# vi Dockerfile-nginx 
FROM centos:centos7.9.2009
MAINTAINER Chinaskills
RUN rm -rf /etc/yum.repos.d/*
COPY local.repo /etc/yum.repos.d/
COPY yum /root/yum
RUN yum -y install nginx
ADD nginx.conf /etc/nginx/nginx.conf
RUN /bin/bash -c 'echo init ok'
EXPOSE 80
CMD ["nginx","-g","daemon off;"]

[root@master DjangoBlog]# docker build -t blog-nginx:v1.0 -f Dockerfile-nginx .
```

8、【实操题】容器化Blog服务（2分）

在master节点/root/DjangoBlog目录下编写Dockerfile-blog文件构建blog-service:v1.0镜像，具体要求如下：（需要用到的软件包：Django.tar.gz）

（1）基础镜像：centos:7.9.2009；

（2）安装Python3.6环境；

（3）使用pip3工具离线安装requirements.txt中的软件包；

（4）安装DjangoBlog服务；

（5）声明端口：8000；

（6）设置DjangoBlog服务开机自启。

完成后构建镜像，并提交master节点的用户名、密码和IP地址到答题框。

```dockerfile
[root@master DjangoBlog]# vi Dockerfile-blog
FROM centos:centos7.9.2009
MAINTAINER Chinaskills
RUN rm -rfv /etc/yum.repos.d/*
COPY local.repo /etc/yum.repos.d/
COPY yum /root/yum
RUN yum install -y make openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel gcc gcc-devel python-devel mysql-devel
COPY Python-3.6.5.tgz /opt
RUN tar -zxvf /opt/Python-3.6.5.tgz
RUN mv Python-3.6.5 /usr/local
RUN cd /usr/local/Python-3.6.5/ && ./configure && make && make install
RUN ln -s /usr/local/python3/bin/python3 /usr/bin/python3
RUN ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3
ADD requirements.txt requirements.txt
COPY Python-pip /opt
RUN pip3 install --upgrade pip --no-index --find-links=/opt
RUN pip3 install -r requirements.txt --no-index --find-links=/opt
RUN pip3 install gunicorn[gevent] --no-index --find-links=/opt   #这是什么意思
RUN pip3 cache purge
RUN mkdir -p /code/djangoBlog
ADD . /code/djangoBlog/
RUN chmod +x /code/djangoBlog/bin/docker_start.sh
ENTRYPOINT ["/code/djangoBlog/bin/docker_start.sh"]

[root@master DjangoBlog]# docker build -t blog-service:v1.0 -f Dockerfile-blog .
```



9、【实操题】编排部署博客系统（3分）

在master节点/root/DjangoBlog目录下编写docker-compose.yaml文件，具体要求如下：

（1）容器1名称：blog-memcached；镜像：blog-memcached:v1.0；端口映射：11211:11211；

（2）容器2名称：blog-mysql；镜像：blog-mysql:v1.0；端口映射：3306:3306；

（3）容器3名称：blog-nginx；镜像：blog-nginx:v1.0；端口映射：80:8888；

（4）容器4名称：blog-service；镜像：blog-service:v1.0；端口映射：8000:8000。

完成后编排部署该博客系统，并提交master节点的用户名、密码和IP地址到答题框。

```dockerfile
[root@k8s-master-node1 DjangoBlog]# vi docker-compose.yaml 
version: '3'
services:
  memcached:
    restart: always
    image: blog-memcached:v1.0
    container_name: blog-memcached
    ports:
      - "11211:11211"
  db:
    image: blog-mysql:v1.0
    restart: always
    environment:
      - MYSQL_DATABASE=djangoblog
      - MYSQL_ROOT_PASSWORD=root
    ports:
      - 3306:3306
    depends_on:
      - memcached
    container_name: blog-mysql
  djangoblog:
    image: blog-service:v1.0
    restart: always
    ports:
      - "8000:8000"
    environment:
      - DJANGO_MYSQL_DATABASE=djangoblog
      - DJANGO_MYSQL_USER=root
      - DJANGO_MYSQL_PASSWORD=root
      - DJANGO_MYSQL_HOST=db
      - DJANGO_MYSQL_PORT=3306
      - DJANGO_MEMCACHED_LOCATION=memcached:11211
    volumes:
      - ./collectedstatic:/code/djangoBlog/collectedstatic
    links:
      - db
      - memcached
    depends_on:
      - db
    container_name: blog-service
  nginx:
    restart: always
    image: blog-nginx:v1.0
    volumes:
      - ./collectedstatic:/code/djangoblog/collectedstatic
    ports:
      - "8888:80"
      - "443:443"
    links:
      - djangoblog:djangoblog
    container_name: blog-nginx
    
[root@k8s-master-node1 DjangoBlog]# docker-compose up -d

docker-compose ps
```

![image-20221213191215838](2022-12-12.assets/image-20221213191215838.png)

10、【实操题】Pod管理--创建Pod（2分）

在default命名空间下使用nginx:latest镜像创建一个QoS类为Guaranteed的Pod，名称为qos-demo。

完成后提交master节点的IP地址、用户名和密码到答题框。

```yaml
kubectl run qos-demo --image=nginx:latest --dry-run='client' -oyaml > pod.yaml

apiVersion: v1
kind: Pod
metadata:
  name: qos-demo
spec:
  containers:
  - image: nginx
    imagePullPolicy: IfNotPresent
    resources:
      limits:
        memory: "200Mi"
        cpu: "700m"
      requests:
        memory: "200Mi"
        cpu: "700m"
```



11、【实操题】安全管理--配置Pod安全上下文（2分）

使用busybox镜像启动一个名为context-demo的Pod，为该Pod配置安全上下文，要求容器内以用户1000和用户组3000来运行所有进程，并在启动时执行“sleep 1h”命令。

完成后提交master节点的IP地址、用户名和密码到答题框。

```yaml
 kubectl run context-demo  --image=busybox:latest  --dry-run='client' -oyaml > security.yaml
 
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: context-demo
  name: context-demo
spec:
  securityContext:
    runAsUser: 1000
    runAsGroup: 3000
  containers:
  - image: busybox:latest
    imagePullPolicy: IfNotPresent
    name: context-demo
    command:
    - sleep
    - 1h
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Always
status: {}
```

12、【实操题】CRD管理--创建自定义资源类型（2分）

在Kubernetes集群中自定义一种资源类型Student，API为stable.example.com/v1，单数形式为student，复数形式为students，简写为stu，作用域为命名空间级，然后在default命名空间下创建一个名为exam的Student对象。

完成后提交master节点的IP地址、用户名和密码到答题框。（000）

```yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
# metadata.name的内容是由"复数名.分组名"构成，如下，students是复数名，bolingcavalry.k8s.io是分组名
  name: students.stable.example.com
spec:
# 分组名，在REST API中也会用到的，格式是: /apis/分组名/CRD版本
  group: stable.example.com
  versions:
  - name: v1
    storage: true  # 只有一个版本能被标注为storage
    served: true   # 是否有效的开关.
    schema:  
      openAPIV3Schema:
        type: object
  scope: Namespaced    #范围是属于namespace的
  names:
    kind: Student         # 类型名
    plural: students      # 复数名
    singular: student     # 单数名
    shortNames:           # 简称，就像service的简称是svc
    - stu
    
    
apiVersion: stable.example.com/v1
kind: Student
metadata:
  name: exam
```

13、【实操题】解析管理--添加主机别名到Pod（2分）

使用nginx镜像在default命名空间下创建一个名为nginx的Pod，并在Pod的/etc/hosts中添加IP地址127.0.0.1与chinaskills的解析。

完成后提交master节点的IP地址、用户名和密码到答题框。

```yaml
kubectl run nginx --port=80 --image=nginx:latest --dry-run='client' --image-pull-policy='IfNotPresent' -oyaml > hostAliases.yaml

apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: nginx
  name: nginx
spec:
  hostAliases:
  - ip: "127.0.0.1"
    hostnames:
    - "chinaskill"
  containers:
  - image: nginx:latest
    name: nginx
    ports:
    - containerPort: 80
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Always
status: {}


[root@k8s-master-node1 ~]# kubectl exec nginx  -- cat /etc/hosts
# Kubernetes-managed hosts file.
127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
fe00::0 ip6-mcastprefix
fe00::1 ip6-allnodes
fe00::2 ip6-allrouters
10.244.0.24     nginx

# Entries added by HostAliases.
127.0.0.1       chinaskill
```

14、【实操题】HPA管理--创建HPA规则（2分）

默认情况下HPA是无法调整伸缩灵敏度的，但不同的业务场景对伸缩灵敏度的要求不一样。要求在default命名空间下使用nginx镜像创建一个名为web的deployment，自定义HPA的伸缩灵敏度，为该deployment创建一个名为web的HPA，扩容时立即新增当前9倍数量的副本数，时间窗口为5s，伸缩范围为1--1000。例如一开始只有1个Pod，当CPU使用率超过80%时，Pod数量变化趋势为：1 → 10 → 100 → 1000。

完成后提交master节点的IP地址、用户名和密码到答题框。

```yaml
kubectl create deploy web --image=nginx:latest --port=80

autoscaling/v2beta2



apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  name: web
spec:
  maxReplicas: 1000
  minReplicas: 1
  metrics:
  - type: Resource
    resource:
      name: cpu
      target: 
        averageUtilization: 80
        type: Utilization
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: web
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
      - periodSeconds: 5
        type: Percent
        value: 900
```

```bash
[root@k8s-master-node1 ~]# kubectl get hpa.v2beta2.autoscaling web -oyaml
```

15、【实操题】流量管理--创建Ingress Gateway（2分）

使用提供的软件包ServiceMesh.tar.gz将Bookinfo应用部署到default命名空间下，使用Istio Gateway可以实现应用程序从外部访问，请为Bookinfo应用创建一个名为bookinfo-gateway的网关，指定所有HTTP流量通过80端口流入网格，然后将网关绑定到虚拟服务bookinfo上。

完成后提交master节点的IP地址、用户名和密码到答题框。

```

```

16、【实操题】服务网格--创建基于用户身份的路由（2分）

创建一个名为reviews路由，要求来自名为Jason的用户的所有流量将被路由到服务reviews:v2。

完成后提交master节点的用户名、密码和IP到答题框。

```

```

![ab577ddb3157a01142d7e1a569fd7f1](2022-12-12.assets/ab577ddb3157a01142d7e1a569fd7f1.jpg)

17、【实操题】VM管理--创建VM（2分）

使用镜像fedora-virt:v1.0在default命名空间下创建一台vm，名称为vm-fedora，内存为1G。

完成后提交master节点的IP地址、用户名和密码到答题框。（0？？）

```yaml
apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachineInstance
metadata:
  name: vm-fedora
spec:
  terminationGracePeriodSeconds: 30
  domain:
    resources:
      requests:
        memory: 1024M
    devices:
      disks:
      - name: containerdisk
        disk:
          bus: virtio
  volumes:
  - name: containerdisk
    containerDisk:
      image: fedora-virt:v1.0 
      imagePullPolicy: IfNotPresent
```

![2f136904811015c244c5309712c5f84](2022-12-12.assets/2f136904811015c244c5309712c5f84.jpg)

18、【实操题】存储与卷--创建emptyDisk卷（2分）

使用镜像fedora-virt:v1.0在default命名空间下创建一台vmi，名称为vmi-fedora，并使用emptyDisk卷为vmi挂载一块2G的磁盘。

完成后提交master节点的IP地址、用户名和密码到答题框。（0.5）

```yaml
apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachineInstance
metadata:
  name: vmi-fedorm
spec:
  terminationGracePeriodSeconds: 30
  domain:
    resources:
requests:
memory: 1024M
    devices:
disks:
- name: containerdisk
disk:
bus: virtio
- name: emptydisk
disk:
bus: virtio
  volumes:
  - name: containerdisk
    containerDisk:
image: fedora-virt:v1.0
imagePullPolicy: IfNotPresent
  - name: emptydisk
    emptyDisk:
capacity: "2Gi"
```

![30a16c79c1844de5145a59d42a83260](2022-12-12.assets/30a16c79c1844de5145a59d42a83260.jpg)

二、容器云任务（当前任务共20道题目）



19、【实操题】Python运维开发：基于Kubernetes Restful API实现Deployment创建（2分）



在提供的OpenStack私有云平台上，使用k8s-python-dev镜像创建1台云主机，云主机类型使用4vCPU/12G内存/100G硬盘。该主机中已经默认安装了所需的开发环境，登录默认账号密码为“root/1DaoYun@2022”。

使用Kubernetes Restful API库，在/root目录下，创建api_deployment_manager.py文件，要求编写python代码，代码实现以下任务：

（1）编写Python程序实现Deployment资源的创建。Deployment配置信息如下。如果同名Deployment存在，先删除再创建。

（2）创建完成后，查询该Deployment的详细信息，执行结果控制台输出，以yaml格式展示。

创建Deployment 的yaml的配置如下：

apiVersion: apps/v1

kind: Deployment

metadata:

 name: nginx-deployment

 labels:

 app: nginx

spec:

 replicas: 3

 selector:

 matchLabels:

 app: nginx

 template:

 metadata:

 labels:

 app: nginx

 spec:

 containers:

 \- name: nginx

 image: nginx:1.15.4

 ports:

 \- containerPort: 80

```

```

20、【实操题】Python运维开发：基于Kubernetes Python SDK实现Job创建（2分）



在前面已建好的Kubernetes开发环境云平台上。使用Kubernetes python SDK的“kubernetes”Python库，在/root目录下，创建sdk_job_manager.py文件，要求编写python代码，代码实现以下任务：

（1）编写Python程序实现Job资源的创建。Job配置信息如下。如果同名Job存在，先删除再创建。

（2）创建完成后，查询该Job的详细信息，执行结果控制台输出，以json格式展示。

Job创建yaml的信息如下：

apiVersion: batch/v1

kind: Job

metadata:

 name: pi

spec:

 template:

 spec:

 containers:

 \- name: pi

 image: perl

 command: ["perl", "-Mbignum=bpi", "-wle", "print bpi(2000)"]

 restartPolicy: Never

 backoffLimit: 4

```

```

```
时间得分任务名称题目

2022-12-12 16:07:270二、容器云任务20、Python运维开发：基于Kubernetes Python SDK实现Job创建

2022-12-12 16:06:550二、容器云任务19、Python运维开发：基于Kubernetes Restful API实现Deployment创建

2022-12-12 16:04:430二、容器云任务18、存储与卷--创建emptyDisk卷

2022-12-12 15:57:150二、容器云任务17、VM管理--创建VM

2022-12-12 15:49:350二、容器云任务16、服务网格--创建基于用户身份的路由

2022-12-12 15:45:122二、容器云任务15、流量管理--创建Ingress Gateway

2022-12-12 15:24:080二、容器云任务14、HPA管理--创建HPA规则

2022-12-12 15:22:450二、容器云任务13、解析管理--添加主机别名到Pod

2022-12-12 15:14:160二、容器云任务12、CRD管理--创建自定义资源类型

2022-12-12 15:05:360二、容器云任务11、安全管理--配置Pod安全上下文

2022-12-12 14:46:110二、容器云任务10、Pod管理--创建Pod

2022-12-12 14:08:583二、容器云任务9、编排部署博客系统

2022-12-12 13:49:092二、容器云任务8、容器化Blog服务

2022-12-12 13:25:081二、容器云任务7、容器化前端服务

2022-12-12 13:16:342二、容器云任务6、容器化Mariadb服务

2022-12-12 13:06:202二、容器云任务5、容器化Memcached服务

2022-12-12 12:47:042二、容器云任务4、平台部署--部署Harbor仓库及Helm包管理工具

2022-12-12 12:24:462二、容器云任务3、平台部署--部署KubeVirt虚拟化

2022-12-12 12:22:120二、容器云任务2、平台部署--部署Istio服务网格

2022-12-12 12:19:042二、容器云任务1、平台部署--部署容器云平台

2022-12-12 11:58:360一、私有云任务25、Python运维开发：基于Openstack Python SDK实现云主机创建

2022-12-12 11:57:450一、私有云任务24、Python运维开发：基于OpenStack Restful API实现镜像上传

2022-12-12 11:57:200一、私有云任务23、OpenStack Nova清除缓存

2022-12-12 11:56:560一、私有云任务22、glance对接cinder后端存储

2022-12-12 11:56:280一、私有云任务21、OpenStack开放镜像权限

2022-12-12 11:56:010一、私有云任务20、Linux系统调优-防止SYN攻击

2022-12-12 11:55:380一、私有云任务19、OpenStack参数调优

2022-12-12 11:55:140一、私有云任务18、修改文件句柄数

2022-12-12 11:54:500一、私有云任务17、OpenStack Glance镜像压缩

2022-12-12 11:54:280一、私有云任务16、OpenStack平台内存优化

2022-12-12 11:53:570一、私有云任务15、Cloudkitty服务安装与使用

2022-12-12 11:53:310一、私有云任务14、manila安装

2022-12-12 11:53:040一、私有云任务13、Barbican服务安装与使用

2022-12-12 11:52:380一、私有云任务12、Cinder创建硬盘

2022-12-12 11:52:130一、私有云任务11、Swift安装

2022-12-12 11:51:480一、私有云任务10、Doshboard安装

2022-12-12 11:51:270一、私有云任务9、Neutron安装

2022-12-12 11:50:590一、私有云任务8、Nova安装与优化

2022-12-12 11:50:290一、私有云任务7、Glance安装与使用

2022-12-12 11:49:160一、私有云任务6、Keystone服务安装与使用

2022-12-12 11:48:020一、私有云任务5、数据库安装与调优

2022-12-12 11:46:580一、私有云任务4、基础安装

2022-12-12 11:45:190一、私有云任务3、配置无秘钥ssh

2022-12-12 11:43:460一、私有云任务2、Yum源配置

2022-12-12 11:42:280一、私有云任务1、基础环境配置
```



1、【实操题】私有网络管理





2、【实操题】云实例管理（2分）

登录华为云平台，创建两台云实例，具体要求如下：

（1）计费模式：按需计费；

（2）地域：上海一；

（3）CPU架构：x86计算；

（4）规格：c7.xlarge.2；

（5）镜像：CentOS 7.5 64位；

（6）系统盘：高IO 50G硬盘；

（7）公网带宽：按带宽计费，5Mbps；

（8）实例名称：ChinaSkill-node-1、ChinaSkill-node-2；

（9）登录方式：使用密码登录，密码自定义。

创建完成后，提交当前的AK（SecretId）、SK（SecretKey）和ChinaSkill-node-1的实例ID到答题框。

```

```

3、【实操题】数据库管理（2分）

使用intnetX-mysql网络创建两台chinaskill-sql-1和chinaskill-sql-2云服务器，使用提供的压缩文件rocketchat-cloud.tar.gz中的软件包源，在chinaskill-sql-1和chinaskill-sql-2中部署MongoDB数据库服务。配置完成后提交连接chinaskill-sql-1节点的用户名、密码和公网IP地址到答题框。

```
yum -y install mongodb-org
systemctl enable --now mongod
```

4、【实操题】主从数据库（2分）

在chinaskill-sql-1和chinaskill-sql-2云服务器中配置MongoDB主从数据库，配置MongoDB集群名称为rs并完成集群设置。完成后提交连接chinaskill-sql-1节点的用户名、密码和公网IP地址到答题框。

```
#主库
[root@mysql-1 ~]# vi /etc/mongod.conf
net:
  port: 27017
  bindIp: 0.0.0.0  # 修改

replication:
  replSetName: rs   #添加
  
删除从库数据库
> use config
switched to db config
> db.dropDatabase()
{ "dropped" : "config", "ok" : 1 }
[root@mysql-1 ~]# vi /etc/mongod.conf
net:
  port: 27017
  bindIp: 0.0.0.0  # 修改

replication:
  replSetName: rs   #添加
重启systemctl restart mongod
```

```
数据库配置
#主库
> use admin 
switched to db admin
> config={_id:'rs',members:[{_id:0,host:'172.16.2.68:27017'},{_id:1,host:'172.16.2.204:27017'}]};
{
        "_id" : "rs",
        "members" : [
                {
                        "_id" : 0,
                        "host" : "172.16.2.68:27017"
                },
                {
                        "_id" : 1,
                        "host" : "172.16.2.204:27017"
                }
        ]
}
> rs.initiate(config)
{ "ok" : 1 }    #要显示ok 1

#报错把从配置文件主从配置去掉重启服务在从上进入库后执行db.dropDatabase(),清空所有的数据库，一个也不要留，直到show dbs为空
rs:SECONDARY> rs.status()
{
        "set" : "rs",
        "date" : ISODate("2022-12-13T14:51:21.843Z"),
        "myState" : 1,
        "term" : NumberLong(1),
```

5、【实操题】node环境管理（2分）

使用提供的压缩文件rocketchat-cloud.tar.gz中软件包源，在ChinaSkill-node-1部署nodejs，根据所提供的rocket.chat所需要求安装nodejs对应版本。配置完成后提交连接ChinaSkill-node-1节点的用户名、密码和公网IP地址到答题框。

```
[root@chinaskill-sql-1 rocketchat-cloud]# chmod +x setup_12.x 
[root@chinaskill-sql-1 rocketchat-cloud]# ./setup_12.x 
[root@chinaskill-sql-1 rocketchat-cloud]# sudo yum install -y nodejs
```

6、【实操题】安全组管理（2分）

创建一个安全组，具体要求如下：

（1）名称：intnetX-security；

（2）允许策略：只放行源地址为172.16.1.0/24访问27017端口；

（3）允许策略：只放行源地址为172.16.1.0/24使用ping命令访问；

（4）关联实例：将intnetX-security安全组关联至所创建的数据库中；

创建完成后，提交当前的AK（SecretId）、SK（SecretKey）和安全组ID到答题框。

```

```

7、【实操题】RocketChat上云（2分）

参考【https://lala.im/2705.html】

参考【https://blog.51cto.com/liangww/5053015】

使用http服务器提供的压缩文件rocketchat-cloud.tar.gz中的RocketChat软件包，在ChinaSkill-node-1中部署RocketChat的Web服务。使用chinaskill-sql-1的MongoDB为后端数据库，设置RocketChat服务访问端口为3000。完成Rocketchat系统上云后，将ChinaSkill-node-1节点的用户名、密码和公网IP地址到答题框。(0？？？)

```
yum -y install gcc gcc-c++ GraphicsMagick

[root@chinaskill-sql-1 rocketchat-cloud]# cd bundle/programs/server/
[root@chinaskill-sql-1 server]# npm install
回到Rocket.Chat根目录下：

配置mongodb环境变量：
[root@chinaskill-node-0001 bundle]# export PORT=3000
[root@chinaskill-node-0001 bundle]# export ROOT_URL='http://116.63.33.97:3000'
[root@chinaskill-node-0001 bundle]# export MONGO_URL='mongodb://root:'Abc@1234'@116.63.37.10:27017/rocketchat?replicaSet=rs'

设置mongodb开机启动以及现在就运行mongodb：
chkconfig mongod on
systemctl start mongod
```

8、【实操题】NAT网关（2分）

创建一个公网NAT网关，具体配置如下：

（1）名称为：kcloud-nat；

（2）虚拟私有云：intnetX；

（3）子网：intnetX-server；

（4）规则：内部子网地址访问外网；

（5）设置Chinaskill-node-1云服务器3000端口转换为外部3000服务端口。

创建完成后提交当前的AK（SecretId）、SK（SecretKey）和NAT网关的ID到答题框。

```

```

9、【实操题】云备份（2分）

创建一个云服务器备份存储库名为server_backup，容量为100G。将ChinaSkill-node-1云服务器制作镜像文件chinaskill-image。完成后，将当前的AK（SecretId）、SK（SecretKey）和存储库ID到答题框。

```

```

10、【实操题】负载均衡器（2分）

创建一个负载均衡器chinaskill-elb，将ChinaSkill-node-1和ChinaSkill-node-2加入负载均衡的后端。设置一个可用的公网服务IP，服务端口为3000。配置监听器，监听3000端口。对浮动公共IP进行Web访问测试。完成后，提交当前的AK（SecretId）、SK（SecretKey）和负载均衡器的ID到答题框。

```

```

11、【实操题】弹性伸缩管理（2分）



新建一个启动配置，具体要求如下：

（1）启动配置名称：template-exam；

（2）计费模式：按量计费；

（3）地域：上海一；

（4）镜像：chinaskill-image；

（5）登录方式：使用密码登录，密码自定义。

创建一个伸缩组，具体要求如下：

（1）名称：as-exam；

（2）最小伸缩数：1；起始实例数：1；最大伸缩数：5；

（3）启动配置：template-exam；

（4）使用负载均衡：chinaskill-elb；

（5）移出策略：移出最旧的实例。

为伸缩组as-exam新建告警触发策略，具体要求如下：

（1）如果实例的内存利用率在5分钟内的最大值小于40%，且连续发生3次。则实例数减少1台。冷却60秒；

（2）如果实例的内存利用率在5分钟内的最大值大于80%，且连续发生3次。则实例数增加1台。冷却60秒；

（3）如果实例的CPU利用率在5分钟内的最大值小于40%，且连续发生3次。则实例数减少1台。冷却60秒；

（4）如果实例的CPU利用率在5分钟内的平均值大于等于80%，且连续发生3次。则实例数增加1台。冷却60秒。

创建完成后提交当前的AK（SecretId）、SK（SecretKey）和伸缩组的实例ID到答题框。

```

```

12、【实操题】云容器引擎（2分）

创建一个x86架构集群，具体要求如下：

（1）集群名称：kcloud；

（2）集群版本：v1.21；

（3）地域：上海一；

（4）集群管理规模：50节点；

（5）控制节点数：3；

（6）节点使用子网：intnetX-server；

（7）Pod实例上限：64；

（8）容器网段：10.10.0.0/16。

节点配置信息要求如下：

（1）节点名称：kcloud-server；

（2）节点规格：c6s.xlarge.2

（3）节点：EulerOS 2.9

创建完成后提交当前的AK（SecretId）、SK（SecretKey）和集群的ID到答题框。 （0 ？？？）

```

```



13、【实操题】云容器管理

安装dashboard

![image-20221215170722662](2022-12-12.assets/image-20221215170722662.png)

14、【实操题】使用kubectl操作集群（2分）

在kcloud集群中安装kubectl命令，使用kubectl命令管理kcloud集群。完成后提交连接kcloud集群节点的用户名、密码和公网IP地址到答题框。

![image-20221214171235958](2022-12-12.assets/image-20221214171235958.png)

15、【实操题】安装helm（2分）

使用提供的helm软件包（软件包为helm-v3.3.0-linux-amd64.tar.gz在http服务下），在kcloud集群中安装helm服务。完成后提交连接kcloud集群节点的用户名、密码和公网IP地址到答题框。

```
[root@kcloud-server ~]# tar -zxf helm-v3.3.0-linux-amd64.tar.gz
[root@kcloud-server ~]# cp -f linux-amd64/helm /usr/local/bin/
[root@kcloud-server ~]# helm version
version.BuildInfo{Version:"v3.3.0", GitCommit:"8a4aeec08d67a7b84472007529e8097ec3742105", GitTreeState:"dirty", GoVersion:"go1.14.7"}
```



16、【实操题】云硬盘存储卷（2分）

购买云硬盘存储卷，具体配置如下：

（1）名称为：ckloud-disk；

（2）集群：kcloud；

（3）容量：30G；

（4）类型：高I/O；

完成后提交连接kcloud集群节点的用户名、密码和公网IP地址到答题框。 （1.33 把名字改了 ）

![image-20221215170618727](2022-12-12.assets/image-20221215170618727.png)

17、【实操题】多容器Pod管理（2分）（这种题好像只检测创建没创建）

在kcloud集群节点/root目录下编写YAML文件mu-pod.yaml，具体要求如下：

（1）Pod名称：mu-pod；

（2）命名空间：default；

（3）Pod包含两个容器：

• 容器1名称：containers01；镜像：nginx；容器端口：80；

• 容器2名称：containers02；镜像：tomcat；容器端口：8080；

（4）拉取策略：IfNotPresent。

完成后使用该YAML文件创建Pod，并提交master节点的用户名、密码和IP到答题框。（0？？）

```bash
kubectl run mu-pod --image=nginx --port='80' --dry-run='client' -oyaml > mu-pod.yaml

apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: mu-pod
  name: mu-pod
  namespace: default
spec:
  containers:
  - image: nginx
    imagePullPolicy: IfNotPresent
    name: containers01
    ports:
    - containerPort: 80
  - image: tomcat
    imagePullPolicy: IfNotPresent
    name: containers02
    ports:
    - containerPort: 8080
  dnsPolicy: ClusterFirst
  restartPolicy: Always
status: {}
```

![image-20221214105202648](2022-12-12.assets/image-20221214105202648.png)

![image-20221214105306722](2022-12-12.assets/image-20221214105306722.png)

**因为没创建**

![image-20221214105614253](2022-12-12.assets/image-20221214105614253.png)

18、【实操题】Namespace管理（2分）

在kcloud集群节点/root目录下编写YAML文件my-namespace.yaml，具体要求如下：

（1）Namespace名称：test。

完成后使用该YAML文件创建Namespace，并提交master节点的用户名、密码和IP到答题框。

```bash
kubectl create ns test --dry-run='client' --output='yaml' > my-namespace.yaml
```

 

19、【实操题】Secrets管理--Opaque（2分）

在master节点/root目录下编写YAML文件secret.yaml，具体要求如下：

（1）Secret名称：mysecret；

（2）命名空间：default；

（3）类型：Opaque；

（4）username: YWRtaW4=；password: MWYyZDFlMmU2N2Rm。

完成后使用该YAML文件创建Secret，并提交master节点的用户名、密码和IP到答题框。

```bash
[root@kcloud-server ~]# kubectl create secret generic mysecret --type='Opaque' --from-literal=username=YWRtaW4=  --from-literal=password=MWYyZDFlMmU2N2Rm --dry-run='client' -oyaml >  secret.yaml

命令创建后数据内容会被改成base64，记得求改内容


apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
```



20、【实操题】使用helm模板（2分）

使用赛项提供的mychart-0.1.0.tgz模板包（在http服务下），修改模板代码使外部可通过节点地址进行访问。在模板市场中上传我的模板mychart，在kcloud集群中安装名为nginx的模板实例。完成后提交连接kcloud集群节点的用户名、密码和公网IP地址到答题框。

```bash
tar xzvf mychart-0.1.0.tgz 

[root@kcloud-server ~]# vim mychart/values.yaml 
service:
  type: NodePort
  port: 80

打包
[root@kcloud-server ~]# helm package ./mychart

点击模板市场，上传
```

21、【实操题】Python运维开发：华为云Python 运行环境准备（4分）

通过华为云控制台，选择北京四区域，创建一台 x86 架构，“按需计费”的2核，4G，系统盘50G的云实例，实例名为chinaskill2022，选择镜像为CentOS 7.9 64bit(40GB)，分配独立的公网IP，带宽选择按使用流量计费5M。登录此云服务器，安装Python3.68运行环境，并安装华为云旧版SDK、新版(v3.0) Python SDK中弹性云服务、虚拟私有云、镜像服务、容器云引擎的python库。

完成后提交“chinaskill2022开发运行环境云主机”的用户名、密码和 IP 地址到答题框。

```bash
HUAWEICloud-Python.zip

1. upgrade pip
python3 -m pip install --upgrade pip

2. install huaweicloud-sdk-python
python3 -m pip install huaweicloud-sdk-python

pip3 install huaweicloudsdkecs
pip3 install huaweicloudsdkims
pip3 install huaweicloudsdkvpc
pip3 install huaweicloudsdkcce
```

22、【实操题】Python运维开发：实现容器集群创建（6分）

基于在Huawei Cloud API的云容器引擎CCE Python模块，使用以下信息，在/root目录下手动编写cce_cluser.yaml文件。

云服务器的/root/ 目录下编写cce_cluster_manager.py 文件，编码实现读取cce_cluser.yaml，创建“按需计费”的CCE容器引擎集群（Cluster），创建后根据名称查询该集群（Cluster）的详细信息，通过控制台以json格式输出该集群的信息。

创建CCE集群的信息如下：

CCE名称chinaskillscce2022；

按需计费；集群版本：v1.21；

集群规模：节点数50；

网络模式：VPC网络；

其他必要信息不限。

完成后提交“chinaskill2022开发运行环境云主机”的用户名、密码和 IP 地址到答题框。

```python
vi cce_cluser.yaml

kind: Cluster
apiVersion: v3
metadata:
  name: chinaskillscce2022
spec: 
  flavor: cce.s1.small
  version: v1.21
  hostNetwork:
    vpc: 65e52a8a-32fd-43f6-bbf2-c1af8f631eff
    subnet: cebfaacd-67ad-40c9-8599-a5fa637f4713
  containerNetwork
    mode: vpc-router
    
    
    
vi cce_cluster_manager.py
# coding: utf-8

from huaweicloudsdkcore.auth.credentials import BasicCredentials
from huaweicloudsdkcce.v3.region.cce_region import CceRegion
from huaweicloudsdkcore.exceptions import exceptions
from huaweicloudsdkcce.v3 import *

if __name__ == "__main__":
    ak = "<YOUR AK>"
    sk = "<YOUR SK>"

    credentials = BasicCredentials(ak, sk) \

    client = CceClient.new_builder() \
        .with_credentials(credentials) \
        .with_region(CceRegion.value_of("cn-north-4")) \
        .build()

    try:
        request = ShowClusterRequest()
        request.cluster_id = "24490471-7c2c-11ed-ab7d-0255ac100262"
        response = client.show_cluster(request)
        print(response)
    except exceptions.ClientRequestException as e:
        print(e.status_code)
        print(e.request_id)
        print(e.error_code)
        print(e.error_msg)
```



时间得分任务名称题目

- 2022-12-15 12:06:466三、公有云服务搭建22、Python运维开发：实现容器集群创建

- 2022-12-15 11:04:154三、公有云服务搭建21、Python运维开发：华为云Python 运行环境准备
- 2022-12-15 10:29:042三、公有云服务搭建20、使用helm模板
- 2022-12-15 10:26:472三、公有云服务搭建19、Secrets管理--Opaque
- 2022-12-15 10:18:081三、公有云服务搭建18、Namespace管理
- 2022-12-15 10:17:122三、公有云服务搭建17、多容器Pod管理

- 2022-12-14 10:37:491.33三、公有云服务搭建16、云硬盘存储卷

- 2022-12-14 10:22:522三、公有云服务搭建15、安装helm
- 2022-12-14 10:15:562三、公有云服务搭建14、使用kubectl操作集群

- 2022-12-14 09:42:402三、公有云服务搭建13、云容器管理
- 2022-12-14 09:36:080三、公有云服务搭建12、云容器引擎
- 2022-12-14 01:03:492三、公有云服务搭建11、弹性伸缩管理
- 2022-12-14 00:51:421三、公有云服务搭建10、负载均衡器
- 2022-12-14 00:20:592三、公有云服务搭建9、云备份
- 2022-12-14 00:15:240三、公有云服务搭建8、NAT网关
- 2022-12-14 00:10:300三、公有云服务搭建7、RocketChat上云
- 2022-12-13 23:18:592三、公有云服务搭建6、安全组管理
- 2022-12-13 23:09:120三、公有云服务搭建5、node环境管理
- 2022-12-13 22:52:172三、公有云服务搭建4、主从数据库
- 2022-12-13 22:28:572三、公有云服务搭建3、数据库管理
- 2022-12-13 21:14:192三、公有云服务搭建2、云实例管理
- 2022-12-13 21:08:422三、公有云服务搭建1、私有网络管理
- 2022-12-13 20:59:020二、容器云任务20、Python运维开发：基于Kubernetes Python SDK实现Job创建
- 2022-12-13 20:58:420二、容器云任务19、Python运维开发：基于Kubernetes Restful API实现Deployment创建
- 2022-12-13 20:43:510.5二、容器云任务18、存储与卷--创建emptyDisk卷
- 2022-12-13 20:38:080二、容器云任务17、VM管理--创建VM
- 2022-12-13 20:24:590二、容器云任务16、服务网格--创建基于用户身份的路由
- 2022-12-13 20:24:420二、容器云任务15、流量管理--创建Ingress Gateway
- 2022-12-13 20:20:572二、容器云任务14、HPA管理--创建HPA规则
- 2022-12-13 20:08:272二、容器云任务13、解析管理--添加主机别名到Pod
- 2022-12-13 20:04:442二、容器云任务12、CRD管理--创建自定义资源类型
- 2022-12-13 19:57:492二、容器云任务11、安全管理--配置Pod安全上下文
- 2022-12-13 19:52:042二、容器云任务10、Pod管理--创建Pod
- 2022-12-13 19:13:490.5二、容器云任务9、编排部署博客系统
- 2022-12-13 18:54:102二、容器云任务8、容器化Blog服务
- 2022-12-13 18:29:121二、容器云任务7、容器化前端服务
- 2022-12-13 18:23:212二、容器云任务6、容器化Mariadb服务
- 2022-12-13 18:04:202二、容器云任务5、容器化Memcached服务
- 2022-12-13 17:47:452二、容器云任务4、平台部署--部署Harbor仓库及Helm包管理工具
- 2022-12-13 17:47:252二、容器云任务3、平台部署--部署KubeVirt虚拟化
- 2022-12-13 17:47:092二、容器云任务2、平台部署--部署Istio服务网格
- 2022-12-13 17:46:462二、容器云任务1、平台部署--部署容器云平台
- 2022-12-13 17:05:570一、私有云任务25、Python运维开发：基于Openstack Python SDK实现云主机创建
- 2022-12-13 17:03:152一、私有云任务24、Python运维开发：基于OpenStack Restful API实现镜像上传
- 2022-12-13 16:27:482一、私有云任务23、OpenStack Nova清除缓存
- 2022-12-13 16:26:131.5一、私有云任务22、glance对接cinder后端存储
- 2022-12-13 16:06:082一、私有云任务21、OpenStack开放镜像权限
- 2022-12-13 16:02:172一、私有云任务20、Linux系统调优-防止SYN攻击
- 2022-12-13 16:01:012一、私有云任务19、OpenStack参数调优
- 2022-12-13 15:55:412一、私有云任务18、修改文件句柄数
- 2022-12-13 15:53:442一、私有云任务17、OpenStack Glance镜像压缩
- 2022-12-13 15:50:512一、私有云任务16、OpenStack平台内存优化
- 2022-12-13 15:49:332一、私有云任务15、Cloudkitty服务安装与使用
- 2022-12-13 15:48:422一、私有云任务14、manila安装
- 2022-12-13 15:46:222一、私有云任务13、Barbican服务安装与使用
- 2022-12-13 15:41:510一、私有云任务12、Cinder创建硬盘
- 2022-12-13 15:34:442一、私有云任务11、Swift安装
- 2022-12-13 15:32:572一、私有云任务10、Doshboard安装
- 2022-12-13 15:31:041一、私有云任务9、Neutron安装
- 2022-12-13 15:29:152一、私有云任务8、Nova安装与优化
- 2022-12-13 15:24:451一、私有云任务7、Glance安装与使用
- 2022-12-13 15:18:442一、私有云任务6、Keystone服务安装与使用
- 2022-12-13 15:16:172一、私有云任务5、数据库安装与调优
- 2022-12-13 15:07:420一、私有云任务4、基础安装
- 2022-12-13 15:02:232一、私有云任务3、配置无秘钥ssh
- 2022-12-13 14:55:400一、私有云任务2、Yum源配置
- 2022-12-13 14:53:252一、私有云任务1、基础环境配置





wordpress 应用部署[1 分] ]

 根据提供的 chart 包 wordpress-13.0.23.tgz 部署 wordpress 服务，根据 chart 包中内容创建 wordpress 所需要的 pv，并修改其访问模式为 NodePort。使用修改后的 chart 包创建 wordpress 服务。

完成后提交连接 kcloud 集群节点的用户名、密码和公网 IP 地址到答题框。

参考【https://sunmite.com/post/kubernetes-install-helm-and-wordpress/】

```
tar -xzvf wordpress-13.0.23.tgz
 vi values.yaml 
 type: LoadBalancer 修改为  NodePort
 
 helm install wordpress wordpress
 [root@kcloud-server ~]# kubectl get pvc
NAME                       STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
data-wordpress-mariadb-0   Pending                                                     26s
wordpress                  Pending                                                     27s

[root@kcloud-server ~]# helm inspect values wordpress

vi pv1.yaml

apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv1
spec:
  capacity:
    storage: 8Gi
  volumeMode: Filesystem
  accessModes:
  - ReadWriteOnce
  hostPath:
     path: "/tmp/data01"
     
vi pv2.yaml

apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv2
spec:
  capacity:
    storage: 10Gi
  volumeMode: Filesystem
  accessModes:
  - ReadWriteOnce
  hostPath:
     path: "/tmp/wordpress"


[root@kcloud-server ~]# kubectl get pv
NAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                              STORAGECLASS   REASON   AGE
pv1    8Gi        RWO            Retain           Bound       default/data-wordpress-mariadb-0                           4m2s
pv2    10Gi       RWO            Retain           Available                                                              6s
[root@kcloud-server ~]# kubectl get pvc
NAME                       STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
data-wordpress-mariadb-0   Bound    pv1      8Gi        RWO                           78m
wordpress                  Bound    pv2      10Gi       RWO                           78m
```

```bash
[root@kcloud-server ~]# helm install wordpress wordpress
NAME: wordpress
LAST DEPLOYED: Wed Dec 14 19:34:46 2022
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
CHART NAME: wordpress
CHART VERSION: 13.0.23
APP VERSION: 5.9.2

** Please be patient while the chart is being deployed **

Your WordPress site can be accessed through the following DNS name from within your cluster:

    wordpress.default.svc.cluster.local (port 80)

To access your WordPress site from outside the cluster follow the steps below:

1. Get the WordPress URL by running these commands:

   export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services wordpress)
   export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
   echo "WordPress URL: http://$NODE_IP:$NODE_PORT/"
   echo "WordPress Admin URL: http://$NODE_IP:$NODE_PORT/admin"

2. Open a browser and access WordPress using the obtained URL.

3. Login with the following credentials below to see your blog:

  echo Username: user
  echo Password: $(kubectl get secret --namespace default wordpress -o jsonpath="{.data.wordpress-password}" | base64 --decode)
```

